{% extends "core/base.html" %}
{% load static i18n %}

{% block content %}

    {% now 'm-d-Y' as today %}

    {% for patient in patients %}
      {% if patient.user.birthday|date:'m-d-Y' ==  today %}
        <h2 class="text-tertiary">{% trans "Procedures" %}</h2>

        <div class="alert alert-success" role="alert">
          <p>{{ patient.user.name }} {% trans 'is completing'%} {{ request.user.age }} {% trans 'years old' %}. {% trans 'Are vaccines and checklist up to date'%}? </p>
        </div>

      {% endif %}
    {% endfor %}

    {% if patients.count > 0 %}
      <h2 class="text-tertiary">{% trans "Appointments" %}</h2>

      <div class="alert alert-success" role="alert">
        {% for name, appointments in patients_list_schedule.items %}
          {% if appointments|length > 0 %}
            <a href="{% url 'appointments:list_requests' %}" class="alert-success" >
              <p>{{ name }} {% trans "has" %} {{ appointments|length }}
                {% trans "appointment requests accepted and not visualized" %}.
              </p>
            </a>
          {% else %}
            <p>
              {{ name }} {% trans "has no appointment requests accepted and not visualized" %}.
            </p>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    {% if patients.count > 0 %}
      <div class="alert alert-danger" role="alert">
        {% for name, appointments in patients_list_cancel.items %}
          {% if appointments|length %}
            <a href="{% url 'appointments:list_requests' %}" class="alert-success" >
              <p>{{ name }} {% trans "has" %} {{ appointments|length }}
                {% trans "appointments requests declined and not visualized" %}.
              </p>
            </a>
          {% else %}
            <p>
              {{ name }} {% trans "has no appointment requests declined and not visualized" %}.
            </p>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <h2 class="text-tertiary">{% trans "Forum" %}</h2>
    {% if commentaries|length > 0  %}
      <div class="alert alert-success" role="alert">
        <a href="{% url 'forum:list_commentary' post.category.slug post.category.pk post.pk %}" class="alert-success" >
          <p>{% trans "Your last post has" %} {{ commentaries|length }}
            {% trans " commentaries" %}.
          </p>
        </a>
      </div>
    {% else %}
      <div class="alert alert-success" role="alert">
        <p>{% trans "Your last post has no commentaries" %}.
        </p>
      </div>
    {% endif %}


    <h2 class="text-tertiary">{% trans "Events" %}</h2>
    {% if events|length > 0 %}
      <div class="alert alert-success" role="alert">
        <a href="{% url 'events:list_events' %}" class="alert-success" >
          <p>{% trans "There are" %} {{events|length}} {% trans "events on the next 7 days" %}.</p>
        </a>
      </div>
    {% else %}
      <div class="alert alert-success" role="alert">
        <p>{% trans "There are no events on the next 7 days" %}.</p>
      </div>
    {% endif %}


    {% if patients.count > 0 %}
      <h2 class="text-tertiary">{% trans "Care  line" %}</h2>

      {% for patient in patients %}

      {% if patient.count_incomplete_procedures_for_current_age > 0 %}

        {% if patient.have_procedures_almost_late %}
          <div class="alert alert-warning" role="alert">
        {% else %}
          <div class="alert alert-success" role="alert">
        {% endif %}
            {{patient.user.name}} {% trans "have" %} {{patient.count_incomplete_procedures_for_current_age}} {% trans "procedures to be made." %}
            <a href="{% url 'careline:checklist_detail' patient.user.username %}" class="alert-link">{% trans "Click here to check it" %}.</a>
        </div>

      {% else %}
        <div class="alert alert-success" role="alert">
            {{patient.user.name}} {% trans "don't have procedures to be made." %}
            <a href="{% url 'careline:checklist_detail' patient.user.username %}" class="alert-link">{% trans "But you can check the careline here" %}.</a>
        </div>
      {% endif %}
    {% endfor %}

    {% endif %}

{% endblock %}

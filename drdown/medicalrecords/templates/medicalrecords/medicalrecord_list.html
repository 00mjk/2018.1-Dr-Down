{% extends "core/base.html" %}
{% load markdown_deux_tags %}
{% load static i18n %}
{% block title %}{% trans "Medical Record:" %} {{ related_patient.user.name }}{% endblock %}

{% block css %}
{{block.super}}
  <link href="{% static 'medicalrecords/css/medicalrecords.css' %}" rel="stylesheet">
{% endblock %}

{% block script %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <script>

        $(document).ready(function() {

            $('#home').addClass("active").addClass("show");
            var obj = $('.nav > li > a[href="#home"]');
            obj.parent().addClass('active');
            obj.addClass("show");
            obj.addClass("active");

        })

    </script>

{%endblock script%}


{% block content %}

<div class="container">

    <div class="row justify-content-between mb-3">
        <div class="col-7 col-md ">
           <h2 class="text-tertiary">{{ related_patient.user.name }} {% trans 'Medical Record' %}</h2>
        </div>

        <div class="col-auto float-right mr-0">
            <a href="{% url 'users:patient_medical_sheet' view.kwargs.username  %}" class="btn btn-secondary" >{% trans "Return" %}</a>
        </div>

    </div>

    <div class="row justify-content-center mb-3">
        <div class="col">
            <ul class="nav nav-tabs nav-tabs-extension nav-fill">
                <li class="nav-item active">
                    <a class="nav-link nav-link-extension py-3 px-2 rounded-top" data-toggle="tab" href="#home">{% trans "Patient data" %}</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link nav-link-extension py-3 px-2 rounded-top " data-toggle="tab" href="#menu1">{% trans "Important notes" %}</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link nav-link-extension py-3 px-2 rounded-top " data-toggle="tab" href="#menu2">{% trans "Postnatal data" %}</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link nav-link-extension py-3 px-2 rounded-top " data-toggle="tab" href="#menu3">{% trans "Medical Exams" %}</a>
                </li>

            </ul>

            <div class="tab-content">

                <div id="home" class="tab-pane fade">


                    <div class="row">

                        <h3 class="col text-tertiary">{{ related_patient.user.name }}</h3>

                    </div>

                    <div class="row justify-content-center">

                        <div class="col-auto">
                            {% if related_patient.user.photo %}
                                <img src="{{ related_patient.user.photo.url }}" width="20px" class="align-photo">
                            {% else %}
                                <img src="{% static 'users/img/user.png' %}" class="align-photo">
                            {% endif %}
                        </div>

                        <div class="col border-left">

                            <div class="row">
                                <label class="col"> <strong>{% trans 'Name: '%} </strong> </label>
                                <div class="w-100"></div>
                                <div class="col alert alert-dark mx-3" role="alert"> {{ related_patient.user.name }} </div>
                            </div>

                            <div class="row">
                                <label class="col"><strong>{% trans 'SUS: '%}</strong></label>
                                <div class="w-100"></div>
                                <div class="col alert alert-dark mx-3" role="alert">{{ related_patient.sus_number }} </div>
                            </div>

                            <div class="row">
                                <label class="col"><strong>{% trans 'Birthday: '%}</strong></label>
                                <div class="w-100"></div>
                                <div class="col alert alert-dark mx-3" role="alert">{{ related_patient.user.birthday }}</div>
                            </div>

                            {% if related_patient.user.cpf %}

                                <div class="row">
                                    <label ><strong>{% trans 'cpf: '%}</strong></label>{{ related_patient.cpf }}
                                </div>

                            {% endif %}

                        </div>

                    </div>
                </div>

                <div id="menu1" class="tab-pane fade">

                    <div class="row">

                        <h3 class="col mb-5">{% trans 'Important Notes' %}</h3>

                        {% if user.healthteam %}
                            <div class="col">
                                <a href="{% url 'medicalrecords:create_medicalrecords'  view.kwargs.username  %}" class="btn btn-success float-right" >{% trans "New" %}</a>
                            </div>
                        {% endif %}

                    </div>

                    <div class="list-group">

                        {% for medicalrecord in medicalrecordlist %}

                            <div class="h-blue list-group-item mb-5">

                                <div class="row">
                                    <div class="col alert alert-dark mx-2 my-2">

                                        <p class="text-tertiary h-blue"> {{ medicalrecord.message|markdown }} </p>

                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col border-right border-top">

                                        <p class="text-tertiary h-blue"><label>{% trans 'Author'%}: </label> {{ medicalrecord.author.user.name }} </p>
                                    </div>

                                    <div class="col border-top">

                                        <p class="text-tertiary h-blue"><label>{% trans 'Created at'%}: </label> {{ medicalrecord.day }} </p>

                                    </div>
                                </div>

                                {% if medicalrecord.document %}
                                    <div class="row">
                                        <div class="col">

                                            <p>{% trans 'Attachment:' %} <a class="text-secondary" href="{{ medicalrecord.document.url }}">{{ medicalrecord.document.name }}</a></p>
                                        </div>
                                    </div>
                                {% endif %}

                            </div>

                        {% empty %}

                            <h4>{% trans 'There are no Important notes for this patient.'%}</h4>

                        {% endfor %}
                    </div>

                </div>

                <div id="menu2" class="tab-pane fade">

                    <div class="row mb-5">

                        <div class="col">
                            <h3 >{% trans 'Postnatal data' %}</h3>
                        </div>

                        {% if user.healthteam %}
                            <div class="col-auto">
                                {% if related_patient.staticdata.weight %}
                                    <a href="{% url 'medicalrecords:update_static_data_medicalrecords'  view.kwargs.username %}" class="btn btn-secondary float-right" >{% trans "Edit" %}</a>
                                {% else %}
                                    <a href="{% url 'medicalrecords:create_static_data_medicalrecords'  view.kwargs.username %}" class="btn btn-success float-right" >{% trans "New" %}</a>
                                {% endif %}

                            </div>
                        {% endif %}
                    </div>


                    <div class="row mb-5">


                        {% if related_patient.staticdata %}

                            <div class="col border-right">

                                <div class="row">

                                    <div class="col"><label><strong>{% trans 'Weight at birth: '%} </strong></label></div>
                                    <div class="w-100"></div>
                                    <div class="col mx-3 alert alert-dark" role="alert"> {{ related_patient.staticdata.weight }}</div>

                                </div>

                                <div class="row">

                                    <div class="col"><label><strong>{% trans 'APGAR: '%}</strong></label></div>
                                    <div class="w-100"></div>
                                    <div class="col mx-3 alert alert-dark" role="alert">{{  related_patient.staticdata.APGAR }}</div>

                                </div>


                            </div>

                            <div class="col">

                                <div class="row">

                                    <div class="col"><label><strong>{% trans 'Heart Test:'%}</strong></label></div>
                                    <div class="w-100"></div>
                                    <div class="col mx-3 alert alert-dark" role="alert">
                                        <a class="text-secondary" href="{{ related_patient.staticdata.heart_test.url }}"> {{  related_patient.staticdata.heart_test.name }} </a>
                                    </div>

                                </div>

                                <div class="row">

                                    <div class="col"><label><strong>{% trans 'Ear Test:'%}</strong></label></div>
                                    <div class="w-100"></div>
                                    <div class="col mx-3 alert alert-dark" role="alert">
                                        <a class="text-secondary" href="{{ related_patient.staticdata.ear_test.url }}"> {{  related_patient.staticdata.ear_test.name }} </a>
                                    </div>
                                </div>

                            </div>

                        {% else %}

                            <div class="row">

                                <h3 class="col mx-3">
                                    <label><strong>{% trans 'No postnatal data for this patient.'%} </strong></label>
                                </h3>

                            </div>

                        {% endif %}

                    </div>
                </div>


                <div id="menu3" class="tab-pane fade">


                    <div class="row mb-5">

                        <div class="col">
                            <h3 >{% trans 'Medical Exams' %}</h3>
                        </div>

                        {% if user.healthteam %}
                            <div class="col-auto">
                                {% if specificexams is None %}
                                    <a href="{% url 'medicalrecords:create_specific_exam_medicalrecords'  view.kwargs.username %}" class="btn btn-success float-right" >{% trans "New" %}</a>
                                {% else %}
                                    <a href="{% url 'medicalrecords:update_exams_medicalrecords'  view.kwargs.username %}" class="btn btn-secondary float-right" >{% trans "Edit" %}</a>
                                {% endif %}

                            </div>
                        {% endif %}
                    </div>


                    <div class="row mb-5">


                        <div class="col border-right">

                            <div class="row">

                                <div class="col"><label><strong>{% trans 'Structured Physical:'%}</strong></label></div>
                                <div class="w-100"></div>
                                <div class="col mx-3 alert alert-dark" role="alert">


                                    {% if specificexams.structured_physical_exam %}

                                        <a class="text-secondary" href="{{ specificexams.structured_physical_exam.url }}"> {{  specificexams.structured_physical_exam.name }} </a>

                                    {% else %}

                                        <h6 class="text-secondary"> {% trans 'Not send' %} </h6>

                                    {% endif %}

                                </div>

                            </div>


                            <div class="row">

                                <div class="col"><label><strong>{% trans 'Vision:'%}</strong></label></div>
                                <div class="w-100"></div>
                                <div class="col mx-3 alert alert-dark" role="alert">

                                    {% if specificexams.vision %}

                                        <a class="text-secondary" href="{{ specificexams.vision.url }}"> {{  specificexams.vision.name }} </a>

                                    {% else %}

                                        <h6 class="text-secondary"> {% trans 'Not send' %} </h6>

                                    {% endif %}

                               </div>

                            </div>

                            <div class="row">

                                <div class="col"><label><strong>{% trans 'Ear:'%}</strong></label></div>
                                <div class="w-100"></div>
                                <div class="col mx-3 alert alert-dark" role="alert">

                                    {% if  specificexams.ear %}

                                        <a class="text-secondary" href="{{ specificexams.ear.url }}"> {{  specificexams.ear.name }} </a>

                                    {% else %}

                                        <h6 class="text-secondary"> {% trans 'Not send' %} </h6>

                                    {% endif %}

                                </div>

                            </div>


                        </div>

                        <div class="col">

                            <div class="row">

                                <div class="col"><label><strong>{% trans 'Heart:'%}</strong></label></div>
                                <div class="w-100"></div>
                                <div class="col mx-3 alert alert-dark" role="alert">

                                    {% if specificexams.hearth %}

                                        <a class="text-secondary" href="{{ specificexams.hearth.url }}"> {{  specificexams.hearth.name }} </a>

                                    {% else %}

                                        <h6 class="text-secondary"> {% trans 'Not send' %} </h6>

                                    {% endif %}

                                </div>

                            </div>

                            <div class="row">

                                <div class="col"><label><strong>{% trans 'Muscle skeletal system:'%}</strong></label></div>
                                <div class="w-100"></div>
                                <div class="col mx-3 alert alert-dark" role="alert">

                                    {% if specificexams.muscle_skeletal_system %}

                                        <a class="text-secondary" href="{{ specificexams.muscle_skeletal_system.url }}"> {{  specificexams.muscle_skeletal_system.name }} </a>

                                    {% else %}

                                        <h6 class="text-secondary"> {% trans 'Not send' %} </h6>

                                    {% endif %}

                                </div>
                            </div>


                            <div class="row">

                                <div class="col"><label><strong>{% trans 'Nervous System:'%}</strong></label></div>
                                <div class="w-100"></div>
                                <div class="col mx-3 alert alert-dark" role="alert">

                                    {% if  specificexams.nervous_system %}

                                        <a class="text-secondary" href="{{ specificexams.nervous_system.url }}"> {{  specificexams.nervous_system.name }} </a>

                                    {% else %}

                                        <h6 class="text-secondary"> {% trans 'Not send' %} </h6>

                                    {% endif %}

                                </div>

                            </div>

                        </div>



                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
{% endblock content %}

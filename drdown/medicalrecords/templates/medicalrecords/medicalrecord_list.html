{% extends "core/base.html" %}
{% load markdown_deux_tags %}
{% load static i18n %}
{% block title %}{% trans "Medical Records:" %}{% endblock %}

{% block css %}
{{block.super}}
<link href="{% static 'medicalrecords/css/medicalrecords.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="size-cont">
  <h2 class="text-tertiary">{{ view.related_patient.user.name }} {% trans 'Medical Records' %}</h2>

  {% if view.related_patient.user.patient  %}
  <div class="mb-4" style="margin:right;">
    {% if user.healthteam %}
      <a href="{% url 'medicalrecords:create_medicalrecords'  view.kwargs.username  %}" class="btn btn-secondary left-btn" >{% trans "New" %}</a>
    {% endif %}
  </div>

    <div>
      {% if view.related_patient.user.photo %}
        <img src="{{ view.related_patient.user.photo }}" width="20px" class="align-photo">
      {% else %}
        <img src="{% static 'users/img/user.png' %}" class="align-photo">
      {% endif %}
    </div>
    <div class="margintoleft">
      <div><label ><strong>{% trans 'Name: '%} </strong></label></div><div class="alert alert-dark" role="alert"> {{ view.related_patient.user.name }}</div>
    <div><label ><strong>{% trans 'SUS: '%}</strong></label></div><div class="alert alert-dark" role="alert">{{ view.related_patient.sus_number }}</div>
      <div><label ><strong>{% trans 'birthday: '%}</strong></label></div><div class="alert alert-dark" role="alert">{{ view.related_patient.user.birthday }}</div>
      {% if view.related_patient.user.cpf %}
          <label ><strong>{% trans 'cpf: '%}</strong></label>{{ view.related_patient.cpf }}
      {% endif %}
    </div>
  </div>


  <div class="container">
    <p>
    {% if  elect_count == 0 %}
    <h4>{% trans 'There are no Medical Records for this patient.'%}</h4>
    {% else %}
    </p>
      <form class="form-inline" action="" method="GET">
        <div class="search"><label>{% trans 'author'%}:</label> {{ form.author }}</div>
        <div class="search"><label>{% trans 'message'%}:</label>{{ form.search_text }}</div>
        <div class="search"><label>{% trans 'date'%}:</label>
        <input type="date"  name="search_date" required=true class="form-control">
          <span class="validity"></span></div>
          <button class="btn align-btn" type="submit">{% trans 'Search' %}</button>
          </fieldset>
      </form>
    {% endif %}
    {% else %}
    {% trans 'This user is not a patient!!!' %}
    {%endif%}
  </div>

<div class="container">
  <div class="list-group">
    {% for medicalrecord in medicalrecord_list %}
    {% if view.kwargs.username == medicalrecord.patient.user.username %}

        <div class="h-blue list-group-item">
          <p class="text-tertiary h-blue"> {{ medicalrecord.message|markdown }} </p>
          <p class="text-tertiary h-blue"> {{ medicalrecord.author }} </p>
          {% if medicalrecord.document %}
          <p>{% trans 'Anexo:' %} <a  href="{{ medicalrecord.document.url }}" style="color: #F00">{{ medicalrecord.document.name }}</a></p>
          {% endif %}
          <p class="text-tertiary h-blue"> {{ medicalrecord.day }} </p>
          {% if user == medicalrecord.author %}
            <a href="{% url 'medicalrecords:update_medicalrecords' view.kwargs.username medicalrecord.pk %}" class="btn btn-secondary">{% trans "Edit" %}</a>
            <a href="{% url 'medicalrecords:delete_medicalrecords' view.kwargs.username medicalrecord.pk %}" class="btn btn-danger">{% trans "Delete" %}</a><br/><br/>
          {% endif %}
        </div>

    {% endif %}

    {% endfor %}
    </div>

  </div>
</div>
{% endblock content %}
